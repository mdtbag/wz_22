# UDP图片传输程序使用说明

## 一、项目介绍
这是一个基于UDP协议的C++图片传输程序，支持**服务器发送图片**、**客户端持续接收并显示图片**，包含两种发送模式（循环发送/手动发送），可快速实现局域网内的图片传输测试。


## 二、项目结构
```
udp_image_transfer/
├── client.cpp       # UDP客户端（接收并显示图片）
├── CMakeLists.txt   # CMake构建配置文件
├── images/          # 测试图片目录
│   ├── test.png     # 测试图片1
│   └── test2.png    # 测试图片2
└── server.cpp       # UDP服务器（发送图片）
```


## 三、前置依赖
确保系统已安装以下工具/库：
1. C++编译器（g++/clang）
2. CMake 3.10+
3. OpenCV库（用于图片读写与显示）
   - Ubuntu安装命令：`sudo apt update && sudo apt install libopencv-dev`


## 四、编译步骤
在项目根目录执行以下命令：
```bash
# 创建构建目录
mkdir build && cd build

# 生成Makefile
cmake ..

# 编译（生成可执行文件）
make
```
编译完成后，`build`目录下会生成两个可执行文件：
- `udp_image_server`：服务器程序
- `udp_image_client`：客户端程序


## 五、运行说明
### 1. 启动客户端（接收图片）
在`build`目录下执行：
```bash
./udp_image_client
```
客户端启动后会持续监听端口（默认8888），输出如下：
```
=== 客户端已启动，持续监听端口 8888 ===
按Ctrl+C退出客户端...
```


### 2. 启动服务器（发送图片）
服务器支持**两种发送模式**，需在`build`目录下执行：

#### 模式1：循环发送同一张图片（测试用）
命令格式：`./udp_image_server <图片路径>`
示例（循环发送`images/test.png`）：
```bash
./udp_image_server ../images/test.png
```
服务器会每2秒发送一次图片，输出如下：
```
=== 循环发送图片模式 ===
发送图片：../images/test.png (按Ctrl+C退出)

Image size to send: xxx bytes
Sent total size: 8 bytes
发送进度：xxx/xxx bytes
✅ 图片发送完成！
```
客户端会每2秒接收并显示一次图片（窗口自动显示2秒后关闭）。


#### 模式2：手动发送不同图片（实用）
命令格式：`./udp_image_server manual <初始图片路径>`
示例（初始发送`images/test.png`，之后可手动输入路径）：
```bash
./udp_image_server manual ../images/test.png
```
服务器启动后会**先发送初始图片**，再提示输入新路径，输出如下：
```
=== 手动发送图片模式 ===
初始图片路径：../images/test.png

正在发送初始图片...

尝试读取图片：../images/test.png
📤 图片大小：xxx 字节
已发送图片大小：8 字节
发送进度：xxx/xxx bytes
✅ 图片发送完成！

=====================================
输入图片路径发送（支持相对/绝对路径）
直接回车：重复发送上一张图片
输入q/Q：退出服务器
=====================================

请输入路径 > 
```

**手动模式操作说明**：
- 直接回车：重复发送上一张图片
- 输入新路径（如`../images/test2.png`）：发送新图片
- 输入`q`/`Q`：退出服务器


## 六、常见问题排查
1. **客户端收不到图片**
   - 确认启动顺序：先启动客户端，再启动服务器
   - 检查端口占用：执行`netstat -anp | grep 8888`，若占用则修改代码中`SERVER_PORT`为其他端口（如8889）后重新编译

2. **服务器提示“读取图片失败”**
   - 检查图片路径：确保输入的相对路径（如`../images/test.png`）正确对应项目结构
   - 检查文件存在性：执行`ls ../images/test.png`确认文件存在
   - 检查文件权限：执行`chmod 644 ../images/*`赋予可读权限

3. **输入q无法退出服务器**
   - 确保输入时无多余空格（如输入`q`而非` q `）


## 七、注意事项
1. UDP是无连接协议，若网络丢包可能导致图片显示异常，建议在稳定局域网内测试
2. 图片会被编码为JPG格式传输，可在`server.cpp`中修改`cv::imencode`的参数（如改为`.png`）调整格式
3. 发送间隔、窗口显示时间可通过修改代码中`sleep(2)`、`cv::waitKey(2000)`的数值调整（单位：秒/毫秒）